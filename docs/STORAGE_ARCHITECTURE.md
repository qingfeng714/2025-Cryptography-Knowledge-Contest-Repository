# ç³»ç»Ÿå­˜å‚¨æ¶æ„è¯´æ˜

## ğŸ“Š å­˜å‚¨æ–‡ä»¶ç±»å‹æ¦‚è§ˆ

ç³»ç»Ÿé‡‡ç”¨**åˆ†å±‚å­˜å‚¨æ¶æ„**ï¼Œæœ€ç»ˆå­˜å‚¨çš„æ–‡ä»¶åŒ…æ‹¬ï¼š

| å±‚çº§ | æ–‡ä»¶ç±»å‹ | æ ¼å¼ | å­˜å‚¨ä½ç½® | è¯´æ˜ |
|------|---------|------|---------|------|
| **1. ä¿æŠ¤å±‚** | ä¿æŠ¤åçš„DICOM | `.dcm` | `output/batch_*/protected_dicom/` | åŠ å¯†/è„±æ•åçš„åŒ»å­¦å½±åƒ |
| **1. ä¿æŠ¤å±‚** | ä¿æŠ¤åçš„æ–‡æœ¬ | `.json` | `output/batch_*/protected_text/` | åŠ å¯†çš„CSVæ•°æ® |
| **1. ä¿æŠ¤å±‚** | å®¡è®¡æ¸…å• | `.json` | `output/batch_*/protected_text/` | æ‰¹æ¬¡å®¡è®¡ä¿¡æ¯ |
| **1. ä¿æŠ¤å±‚** | æ•°å­—ç­¾å | `.sig` | `output/batch_*/protected_text/` | SPHINCS+ç­¾åï¼ˆå¯é€‰ï¼‰|
| **1. ä¿æŠ¤å±‚** | å…¬é’¥ | `.pk` | `output/batch_*/protected_text/` | ç­¾åéªŒè¯å…¬é’¥ |
| **2. å­˜å‚¨å±‚** | CASå¯¹è±¡ | æ— æ‰©å±•å | `storage_repo/cas/` | å†…å®¹å¯»å€å­˜å‚¨ |
| **2. å­˜å‚¨å±‚** | æ‰¹æ¬¡å®¡è®¡ | `.json` | `storage_repo/batches/` | æ‰¹æ¬¡å…ƒæ•°æ® |
| **2. å­˜å‚¨å±‚** | ç´¢å¼•æ•°æ®åº“ | `.sqlite` | `storage_repo/db/` | å¯¹è±¡ç´¢å¼• |
| **3. åº”ç”¨å±‚** | éªŒè¯åŒ… | `.zip` | `output/bundles/` | å¯éªŒè¯çš„æ•°æ®åŒ… |

---

## ğŸ” ç¬¬1å±‚ï¼šä¿æŠ¤å±‚æ–‡ä»¶

### ğŸ“ ç›®å½•ç»“æ„

```
output/
â””â”€â”€ batch_1761149193606/           # æ‰¹æ¬¡ID
    â”œâ”€â”€ protected_dicom/            # ä¿æŠ¤åçš„DICOMæ–‡ä»¶
    â”‚   â”œâ”€â”€ patient00001.dcm       # è„±æ•åçš„DICOM
    â”‚   â”œâ”€â”€ patient00002.dcm
    â”‚   â””â”€â”€ patient00826.dcm
    â”‚
    â””â”€â”€ protected_text/             # ä¿æŠ¤åçš„æ–‡æœ¬æ•°æ®
        â”œâ”€â”€ patient00001.json      # åŠ å¯†çš„CSVæ•°æ®
        â”œâ”€â”€ patient00002.json
        â”œâ”€â”€ patient00826.json
        â”œâ”€â”€ audit_manifest.json    # å®¡è®¡æ¸…å•
        â”œâ”€â”€ audit_manifest.sig     # SPHINCS+æ•°å­—ç­¾åï¼ˆå¯é€‰ï¼‰
        â””â”€â”€ audit_manifest.pk      # ç­¾åéªŒè¯å…¬é’¥ï¼ˆå¯é€‰ï¼‰
```

### 1ï¸âƒ£ ä¿æŠ¤åçš„DICOMæ–‡ä»¶ (`.dcm`)

**æ–‡ä»¶åæ ¼å¼**ï¼š`{patient_id}.dcm`ï¼ˆå¦‚ `patient00826.dcm`ï¼‰

**å†…å®¹**ï¼š
- âœ… **åŸå§‹åƒç´ æ•°æ®ä¿ç•™**ï¼ˆå½±åƒå†…å®¹ï¼‰
- âœ… **å…ƒæ•°æ®åŠ å¯†/è„±æ•**ï¼š
  - PatientID â†’ FPEåŠ å¯†
  - PatientName â†’ FPEåŠ å¯†
  - PatientAge â†’ FPEåŠ å¯†
  - PatientSex â†’ FPEåŠ å¯†
  - å…¶ä»–æ•æ„Ÿå­—æ®µ â†’ AEADåŠ å¯†
- âœ… **ç§æœ‰æ ‡ç­¾**ï¼šå­˜å‚¨åŠ å¯†å…ƒæ•°æ®
  - `(0x0011,0x0010)`: "PROTECT-META"
  - `(0x0011,0x1010)`: åŠ å¯†å­—æ®µJSON

**åŠ å¯†æ–¹æ³•**ï¼š
- **FPE (Format-Preserving Encryption)**ï¼šä¿æŒåŸæ ¼å¼
  - åŸºäº Ascon-PRF
  - å­—æ¯æ•°å­—ä¿æŒå¯è¯»æ€§
- **AEAD (Authenticated Encryption)**ï¼š
  - åŸºäº Ascon AEAD
  - æä¾›è®¤è¯å’ŒåŠ å¯†

**ç¤ºä¾‹**ï¼š
```
åŸå§‹ï¼šPatientID = "patient00826"
åŠ å¯†åï¼šPatientID = "QB7RN37E8V2G6"
```

---

### 2ï¸âƒ£ ä¿æŠ¤åçš„æ–‡æœ¬JSON (`.json`)

**æ–‡ä»¶åæ ¼å¼**ï¼š`{patient_id}.json`ï¼ˆå¦‚ `patient00826.json`ï¼‰

**JSONç»“æ„**ï¼š
```json
{
  "dicom_out": "output/.../patient00826.dcm",
  "sop": "1.2.840.113619.2.55.3...",
  "assoc": "batch_1761149193606",
  "columns": {
    "patient_id": "QB7RN37E8V2G6",
    "patient_sex": "N",
    "patient_age": "67"
  },
  "columns_cipher": {
    "patient_id": {
      "token": "QB7RN37E8V2G6",
      "cipher_b64": "FALLBACK-AbCd...==",
      "hash": "a1b2c3d4...",
      "ad": "{\"tag\":\"patient_id\",\"sop\":\"...\",\"ctx\":\"...\"}",
      "nonce": "1234567890abcdef"
    }
  }
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `dicom_out`: å¯¹åº”çš„DICOMæ–‡ä»¶è·¯å¾„
- `sop`: DICOMçš„SOP Instance UID
- `assoc`: æ‰¹æ¬¡IDï¼ˆå…³è”é”®ï¼‰
- `columns`: FPEåŠ å¯†åçš„å­—æ®µï¼ˆä¿æŒæ ¼å¼ï¼‰
- `columns_cipher`: AEADåŠ å¯†çš„å¯†æ–‡å’Œå…ƒæ•°æ®

---

### 3ï¸âƒ£ å®¡è®¡æ¸…å• (`audit_manifest.json`)

**æ¯ä¸ªæ‰¹æ¬¡ä¸€ä¸ªæ–‡ä»¶**

**JSONç»“æ„**ï¼š
```json
{
  "assoc": "batch_1761149193606",
  "key_hint": "a1b2c3d4e5f67890",
  "count": 1222,
  "created_ms": 1761149193619,
  "items": [
    {
      "dicom": {
        "dicom_in": "uploads/xxx.dcm",
        "dicom_out": "output/.../patient00001.dcm",
        "sop": "1.2.840...",
        "sha256_before": "abc123...",
        "sha256_after": "def456...",
        "fields": [...]
      },
      "text": {
        "path": "output/.../patient00001.json"
      }
    }
  ]
}
```

**ç”¨é€”**ï¼š
- âœ… è®°å½•æ‰¹æ¬¡æ‰€æœ‰æ–‡ä»¶
- âœ… ä¿å­˜åŠ å¯†å‰åå“ˆå¸Œ
- âœ… å®¡è®¡è¿½è¸ª
- âœ… å¯éªŒè¯æ€§

---

### 4ï¸âƒ£ æ•°å­—ç­¾å (`.sig` + `.pk`)

**ä»…å½“SPHINCS+å¯ç”¨æ—¶ç”Ÿæˆ**

**æ–‡ä»¶**ï¼š
- `audit_manifest.sig`: SPHINCS+ç­¾åï¼ˆäºŒè¿›åˆ¶ï¼‰
- `audit_manifest.pk`: éªŒè¯å…¬é’¥ï¼ˆäºŒè¿›åˆ¶ï¼‰

**ç”¨é€”**ï¼š
- âœ… é˜²ç¯¡æ”¹
- âœ… å®¡è®¡æ¸…å•å®Œæ•´æ€§éªŒè¯
- âœ… æŠ—é‡å­æ”»å‡»ï¼ˆSPHINCS+æ˜¯åé‡å­ç­¾åç®—æ³•ï¼‰

---

## ğŸ—„ï¸ ç¬¬2å±‚ï¼šå­˜å‚¨å±‚ï¼ˆCAS + ç´¢å¼•ï¼‰

### ğŸ“ ç›®å½•ç»“æ„

```
storage_repo/
â”œâ”€â”€ cas/                           # å†…å®¹å¯»å€å­˜å‚¨
â”‚   â”œâ”€â”€ ab/                        # SHA256å‰2ä½
â”‚   â”‚   â”œâ”€â”€ c123def...             # DICOMæ–‡ä»¶ï¼ˆæ— æ‰©å±•åï¼‰
â”‚   â”‚   â””â”€â”€ d456abc...             # JSONæ–‡ä»¶ï¼ˆæ— æ‰©å±•åï¼‰
â”‚   â””â”€â”€ cd/
â”‚       â””â”€â”€ ef789...
â”‚
â”œâ”€â”€ batches/                       # æ‰¹æ¬¡å®¡è®¡ææ–™
â”‚   â”œâ”€â”€ batch_1761149193606/
â”‚   â”‚   â”œâ”€â”€ audit_manifest.json
â”‚   â”‚   â”œâ”€â”€ audit_manifest.sig
â”‚   â”‚   â””â”€â”€ audit_manifest.pk
â”‚   â””â”€â”€ batch_1761145851536/
â”‚       â””â”€â”€ audit_manifest.json
â”‚
â””â”€â”€ db/                            # SQLite
    â””â”€â”€ index.sqlite
```

---

### 1ï¸âƒ£ CAS (Content-Addressable Storage)

**æ¦‚å¿µ**ï¼šåŸºäºæ–‡ä»¶å†…å®¹çš„SHA256å“ˆå¸Œå­˜å‚¨

**å­˜å‚¨è·¯å¾„è§„åˆ™**ï¼š
```python
SHA256 = "abc123def456..."
è·¯å¾„ = storage_repo/cas/ab/c123def456...
                        â†‘  â†‘
                    å‰2ä½ å‰©ä½™éƒ¨åˆ†
```

**ç‰¹ç‚¹**ï¼š
- âœ… **å»é‡**ï¼šç›¸åŒå†…å®¹åªå­˜å‚¨ä¸€æ¬¡
- âœ… **å®Œæ•´æ€§**ï¼šæ–‡ä»¶å=å†…å®¹å“ˆå¸Œï¼Œæ— æ³•ç¯¡æ”¹
- âœ… **å¯éªŒè¯**ï¼šé‡æ–°è®¡ç®—SHA256å³å¯éªŒè¯
- âœ… **æ— æ‰©å±•å**ï¼šé€šè¿‡æ•°æ®åº“ç´¢å¼•è¯†åˆ«ç±»å‹

**ç¤ºä¾‹**ï¼š
```
åŸæ–‡ä»¶: patient00826.dcm
SHA256: abc123def456789...
CASè·¯å¾„: storage_repo/cas/ab/c123def456789...
```

---

### 2ï¸âƒ£ SQLiteç´¢å¼•æ•°æ®åº“ (`index.sqlite`)

**æ•°æ®åº“è¡¨ç»“æ„**ï¼š

#### `objects` è¡¨ï¼ˆå¯¹è±¡ç´¢å¼•ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | INTEGER | ä¸»é”® |
| `sop_uid` | TEXT | DICOM SOP UID |
| `patient_id` | TEXT | æ‚£è€…IDï¼ˆåŠ å¯†åï¼‰|
| `dicom_sha256` | TEXT | DICOMæ–‡ä»¶SHA256 |
| `text_sha256` | TEXT | JSONæ–‡ä»¶SHA256 |
| `masked_pixels` | INTEGER | æ©ç åƒç´ æ•° |
| `batch_id` | TEXT | æ‰¹æ¬¡ID |
| `ts_ms` | INTEGER | æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰|
| `dicom_cas` | TEXT | CASä¸­çš„DICOMå“ˆå¸Œ |
| `text_cas` | TEXT | CASä¸­çš„JSONå“ˆå¸Œ |

**SQLåˆ›å»ºè¯­å¥**ï¼š
```sql
CREATE TABLE objects (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    sop_uid TEXT,
    patient_id TEXT,
    dicom_sha256 TEXT,
    text_sha256 TEXT,
    masked_pixels INTEGER,
    batch_id TEXT,
    ts_ms INTEGER,
    dicom_cas TEXT,
    text_cas TEXT
);
CREATE INDEX idx_sop ON objects(sop_uid);
CREATE INDEX idx_patient ON objects(patient_id);
CREATE INDEX idx_batch ON objects(batch_id);
```

#### `batches` è¡¨ï¼ˆæ‰¹æ¬¡ç´¢å¼•ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | TEXT | æ‰¹æ¬¡IDï¼ˆä¸»é”®ï¼‰|
| `audit_sha256` | TEXT | å®¡è®¡æ¸…å•SHA256 |
| `sig_sha256` | TEXT | ç­¾åæ–‡ä»¶SHA256 |
| `pk_sha256` | TEXT | å…¬é’¥æ–‡ä»¶SHA256 |
| `count` | INTEGER | å¯¹è±¡æ•°é‡ |
| `ts_ms` | INTEGER | æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰|

**ç”¨é€”**ï¼š
- âœ… å¿«é€ŸæŸ¥æ‰¾æ‚£è€…æ•°æ®
- âœ… æ‰¹æ¬¡ç®¡ç†
- âœ… å®¡è®¡è¿½è¸ª
- âœ… æ–‡ä»¶å®Œæ•´æ€§éªŒè¯

---

### 3ï¸âƒ£ æ‰¹æ¬¡å®¡è®¡ææ–™

**å­˜å‚¨ä½ç½®**ï¼š`storage_repo/batches/{batch_id}/`

**æ–‡ä»¶**ï¼š
- `audit_manifest.json`: å®¡è®¡æ¸…å•å‰¯æœ¬
- `audit_manifest.sig`: ç­¾åå‰¯æœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
- `audit_manifest.pk`: å…¬é’¥å‰¯æœ¬ï¼ˆå¦‚æœæœ‰ï¼‰

**ç”¨é€”**ï¼š
- âœ… é•¿æœŸä¿å­˜å®¡è®¡è®°å½•
- âœ… ç­¾åéªŒè¯
- âœ… åˆè§„å®¡è®¡

---

## ğŸ“¦ ç¬¬3å±‚ï¼šåº”ç”¨å±‚ï¼ˆéªŒè¯åŒ…ï¼‰

### éªŒè¯åŒ…ç»“æ„ (`.zip`)

**ç”Ÿæˆä½ç½®**ï¼š`output/bundles/{patient_id}_bundle.zip`

**ZIPå†…å®¹**ï¼š
```
patient00826_bundle.zip
â”œâ”€â”€ patient00826.dcm              # ä¿æŠ¤åçš„DICOM
â”œâ”€â”€ patient00826.json             # ä¿æŠ¤åçš„JSON
â”œâ”€â”€ audit_manifest.json           # å®¡è®¡æ¸…å•
â”œâ”€â”€ audit_manifest.sig            # ç­¾åï¼ˆå¦‚æœæœ‰ï¼‰
â””â”€â”€ audit_manifest.pk             # å…¬é’¥ï¼ˆå¦‚æœæœ‰ï¼‰
```

**ç”¨é€”**ï¼š
- âœ… å®Œæ•´çš„å¯éªŒè¯æ•°æ®åŒ…
- âœ… å¯ç‹¬ç«‹ä¸‹è½½å’ŒéªŒè¯
- âœ… åŒ…å«æ‰€æœ‰å®¡è®¡ææ–™
- âœ… æ–¹ä¾¿æ•°æ®äº¤æ¢

---

## ğŸ”„ å®Œæ•´å­˜å‚¨æµç¨‹

### æµç¨‹å›¾

```
åŸå§‹æ•°æ® (CSV + DICOM)
         â†“
    [æ£€æµ‹PHI]
         â†“
    [æ‰§è¡Œä¿æŠ¤]
         â†“
ä¿æŠ¤åæ–‡ä»¶ (output/batch_*/protected_*)
  â”œâ”€ patient00826.dcm (åŠ å¯†çš„DICOM)
  â”œâ”€ patient00826.json (åŠ å¯†çš„JSON)
  â””â”€ audit_manifest.json (å®¡è®¡æ¸…å•)
         â†“
    [å­˜å‚¨å…¥åº“]
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CASå­˜å‚¨      â”‚
    â”‚  (å»é‡å­˜å‚¨)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SQLiteç´¢å¼•   â”‚
    â”‚  (å¿«é€ŸæŸ¥è¯¢)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  æ‰¹æ¬¡å®¡è®¡     â”‚
    â”‚  (åˆè§„è®°å½•)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦ç»†æ­¥éª¤

1. **ä¿æŠ¤é˜¶æ®µ** (`/api/protect_execute`)
   ```
   - è¯»å–æ£€æµ‹ç»“æœ
   - å¯¹DICOMå…ƒæ•°æ®åŠ å¯†ï¼ˆFPE/AEADï¼‰
   - å¯¹CSVæ•°æ®åŠ å¯†
   - ç”Ÿæˆå®¡è®¡æ¸…å•
   - ç”Ÿæˆæ•°å­—ç­¾åï¼ˆå¯é€‰ï¼‰
   - ä¿å­˜åˆ° output/batch_*/
   ```

2. **å…¥åº“é˜¶æ®µ** (`/api/storage/ingest`)
   ```
   - è®¡ç®—æ–‡ä»¶SHA256
   - å­˜å…¥CASï¼ˆå»é‡ï¼‰
   - æ’å…¥SQLiteç´¢å¼•
   - å¤åˆ¶å®¡è®¡ææ–™
   - æäº¤äº‹åŠ¡
   ```

3. **æŸ¥è¯¢é˜¶æ®µ** (`/api/storage/list`)
   ```
   - æŸ¥è¯¢SQLiteæ•°æ®åº“
   - è¿”å›å¯¹è±¡åˆ—è¡¨
   - æ˜¾ç¤ºpatient_idã€æ‰¹æ¬¡ã€å“ˆå¸Œç­‰
   ```

4. **å¯¼å‡ºé˜¶æ®µ** (`/api/storage/bundle`)
   ```
   - æ ¹æ®patient_idæŸ¥è¯¢
   - ä»CASè¯»å–æ–‡ä»¶
   - æ‰“åŒ…æˆZIP
   - åŒ…å«å®¡è®¡ææ–™
   ```

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### åŠ å¯†ç®—æ³•

| ç®—æ³• | ç”¨é€” | ç‰¹ç‚¹ |
|------|------|------|
| **Ascon-PRF** | ä¼ªéšæœºå‡½æ•° | è½»é‡çº§ã€é«˜æ•ˆ |
| **FPE (Format-Preserving)** | æ ¼å¼ä¿ç•™åŠ å¯† | ä¿æŒæ•°æ®æ ¼å¼ |
| **Ascon-AEAD** | è®¤è¯åŠ å¯† | åŠ å¯†+å®Œæ•´æ€§ |
| **SPHINCS+** | åé‡å­ç­¾å | æŠ—é‡å­æ”»å‡» |

### å…³è”é”®æœºåˆ¶

**ç›®çš„**ï¼šè·¨æ¨¡æ€å…³è”è¯†åˆ«

**å®ç°**ï¼š
```python
# ç›¸åŒçš„patient_idä½¿ç”¨ç›¸åŒçš„nonce
nonce = hashlib.sha256(f"{patient_id}|{batch_id}".encode()).digest()[:16]

# ç¡®ä¿ç›¸åŒpatient_idçš„åŠ å¯†tokenä¸€è‡´
token = fpe_encrypt(patient_id, nonce, key)
```

**æ•ˆæœ**ï¼š
- âœ… åŒä¸€æ‚£è€…çš„CSVå’ŒDICOMå¯åŒ¹é…
- âœ… ä¸åŒæ‚£è€…æ— æ³•å…³è”
- âœ… æ”¯æŒè·¨æ¨¡æ€é£é™©è¯„ä¼°

---

## ğŸ“Š å­˜å‚¨ç»Ÿè®¡

### æŸ¥çœ‹å­˜å‚¨çŠ¶æ€

**è¿è¡Œ**ï¼š
```bash
python debug_database.py
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ã€objectsè¡¨ã€‘
æ€»è®°å½•æ•°: 1222

ã€batchesè¡¨ã€‘
æ€»è®°å½•æ•°: 2

ã€CASå­˜å‚¨ã€‘
CASæ–‡ä»¶æ€»æ•°: 2444  (1222 DICOM + 1222 JSON)

ã€æ‰¹æ¬¡ç›®å½•ã€‘
æ‰¹æ¬¡ç›®å½•æ•°é‡: 2
```

### APIæŸ¥è¯¢

**åˆ—å‡ºå¯¹è±¡**ï¼š
```
GET /api/storage/list?limit=20&offset=0
```

**åˆ—å‡ºæ‰¹æ¬¡**ï¼š
```
GET /api/storage/batches?limit=20
```

**è·å–ç»Ÿè®¡**ï¼š
```
GET /api/storage/stats
```

---

## ğŸ” æ–‡ä»¶éªŒè¯

### éªŒè¯CASæ–‡ä»¶å®Œæ•´æ€§

```python
# é‡æ–°è®¡ç®—SHA256
sha256 = hashlib.sha256(file_content).hexdigest()

# ä¸æ–‡ä»¶åæ¯”å¯¹
assert sha256 == cas_filename
```

### éªŒè¯å®¡è®¡æ¸…å•ç­¾å

```python
# è¯»å–å…¬é’¥å’Œç­¾å
pk = Path("audit_manifest.pk").read_bytes()
sig = Path("audit_manifest.sig").read_bytes()
msg = Path("audit_manifest.json").read_bytes()

# éªŒè¯ç­¾åï¼ˆSPHINCS+ï¼‰
assert sphincs.verify(pk, msg, sig)
```

---

## ğŸ“ æ€»ç»“

### æœ€ç»ˆå­˜å‚¨çš„æ–‡ä»¶å½¢å¼

1. **åŠ å¯†çš„DICOMæ–‡ä»¶** (`.dcm`)
   - å…ƒæ•°æ®FPE/AEADåŠ å¯†
   - åƒç´ æ•°æ®ä¿ç•™
   - å­˜å‚¨åœ¨CASä¸­

2. **åŠ å¯†çš„JSONæ–‡ä»¶** (`.json`)
   - CSVæ•°æ®åŠ å¯†
   - åŒ…å«å¯†æ–‡å’Œå…ƒæ•°æ®
   - å­˜å‚¨åœ¨CASä¸­

3. **å®¡è®¡æ¸…å•** (`.json`)
   - æ‰¹æ¬¡æ‰€æœ‰æ–‡ä»¶è®°å½•
   - SHA256å“ˆå¸Œ
   - å¯é€‰æ•°å­—ç­¾å

4. **SQLiteæ•°æ®åº“** (`.sqlite`)
   - å¯¹è±¡ç´¢å¼•
   - æ‰¹æ¬¡ç´¢å¼•
   - å¿«é€ŸæŸ¥è¯¢

5. **éªŒè¯åŒ…** (`.zip`)
   - å®Œæ•´çš„å¯éªŒè¯æ•°æ®åŒ…
   - åŒ…å«å®¡è®¡ææ–™

### æ ¸å¿ƒç‰¹ç‚¹

âœ… **å»é‡å­˜å‚¨**ï¼ˆCASï¼‰  
âœ… **å†…å®¹å¯»å€**ï¼ˆSHA256ï¼‰  
âœ… **å®Œæ•´æ€§éªŒè¯**ï¼ˆå“ˆå¸Œ+ç­¾åï¼‰  
âœ… **å¿«é€ŸæŸ¥è¯¢**ï¼ˆSQLiteç´¢å¼•ï¼‰  
âœ… **å®¡è®¡è¿½è¸ª**ï¼ˆæ¸…å•+ç­¾åï¼‰  
âœ… **æŠ—é‡å­æ”»å‡»**ï¼ˆSPHINCS+ï¼‰  
âœ… **å¯éªŒè¯æ€§**ï¼ˆç‹¬ç«‹éªŒè¯åŒ…ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-23  
**ç›¸å…³æ–‡ä»¶**: `services/protection_service.py`, `services/storage_audit_service.py`

